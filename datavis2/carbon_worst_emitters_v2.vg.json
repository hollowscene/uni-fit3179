{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "width": "container",
  "height": 400,
  "data": {"url": "data/owid-co2-data.csv"},
  "transform": [{
    "filter": "datum.year == Select_Year & datum.iso_code != ''"
  }, {
    "calculate": "toNumber(datum.co2_per_capita)", "as": "co2_per_capita"
  }, {
    "window": [{
      "op": "rank",
      "as": "rank"
    }],
    "groupby": ["year"],
    "sort": [{ "field": "co2_per_capita", "order": "descending" }]
  }, {
    "filter": "datum.rank <= 10"
  }],

  "params": [
    {
      "name": "Select_Year",
      "value": 2020,
      "bind": {
        "input": "range",
        "min": 1800,
        "max": 2020,
        "step": 1,
        "name": "Year: "
      }
    }
  ],

  "layer": [{
    "mark": {"type": "bar", "tooltip": true},
    "encoding": {
      "x": {
          "field": "co2_per_capita",
          "type": "quantitative"
      },
      "y": {
          "field": "country",
          "type": "nominal",
          "sort": {"field": "co2_per_capita", "order": "descending"}
      },
      "color": {
        "field": "Continent", 
        "type": "nominal", 
        "legend": true, 
        "title": ["Continent"]
      },
      "detail": [{
        "field": "rank", "type": "ordinal"
      }, {
        "field": "year", "type": "ordinal"
      }]
    },
    "transform": [{
      "lookup": "country", 
      "from": {
        "data": {"url": "data/continents-according-to-our-world-in-data.csv"},
        "key": "Entity",
        "fields":  ["Year", "Continent"]
      }
    }]
  }],
  
  "config": {
    "background": "white"
  }
}
